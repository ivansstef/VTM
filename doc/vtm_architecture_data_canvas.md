# **VTM ‚Äì Architecture & Data Canvas**

---

## üß© 1. System Overview (–∑–∞–≥–∞–ª—å–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
VTM ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞ –æ—Ñ–ª–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞, –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ –∑–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–º **offline-first**.  
–í–æ–Ω–∞ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —Ç—Ä—å–æ—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö —Ä—ñ–≤–Ω—ñ–≤:

1. **Interface Layer (–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å)** ‚Äî –≤–µ–±-—Ñ–æ—Ä–º–∞ (HTML/JS/Bootstrap), —â–æ –ø—Ä–∞—Ü—é—î —É –±—Ä–∞—É–∑–µ—Ä—ñ —á–∏ —á–µ—Ä–µ–∑ Flask-—Å–µ—Ä–≤–µ—Ä.  
   –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –≤–≤–µ–¥–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤, –∑–≤—ñ—Ç–∏, –¥–æ–≤—ñ–¥–Ω–∏–∫–∏.

2. **Logic Layer (–õ–æ–≥—ñ–∫–∞)** ‚Äî Python (Flask) ‚Äî —Ä–µ–∞–ª—ñ–∑—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏, –æ–±–ª—ñ–∫ –∑–∞–ª–∏—à–∫—ñ–≤, —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é, –µ–∫—Å–ø–æ—Ä—Ç –∑–≤—ñ—Ç—ñ–≤, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é.  
   –ü—ñ–¥‚Äô—î–¥–Ω—É—î—Ç—å—Å—è –¥–æ –±–∞–∑–∏ SQLite.

3. **Data Layer (–î–∞–Ω—ñ)** ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö `main.db` (SQLite), —â–æ –º—ñ—Å—Ç–∏—Ç—å —É—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ (documents, items, stock, users, —Ç–æ—â–æ).

---

## üß± 2. Main Components (–æ—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏)
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó |
|------------|--------------|-------------|
| **Frontend** | –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–≤–≤–µ–¥–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤, —Ñ—ñ–ª—å—Ç—Ä–∏, –∑–≤—ñ—Ç–∏) | HTML, JavaScript, Bootstrap |
| **Backend** | –õ–æ–≥—ñ–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∏, API –º—ñ–∂ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º —ñ –±–∞–∑–æ—é | Python, Flask |
| **Database** | –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —É—Å—ñ—Ö –¥–∞–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∏ | SQLite |
| **Reports Engine** | –§–æ—Ä–º—É–≤–∞–Ω–Ω—è PDF/Excel | ReportLab, OpenPyXL |
| **Backup System** | –†–µ–∑–µ—Ä–≤—É–≤–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è | Python OS, Cron / Task Scheduler |
| **Config System** | –ó–æ–≤–Ω—ñ—à–Ω—ñ–π —Ñ–∞–π–ª –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å | config.ini |

---

## üíæ 3. Database Structure (–±–∞–∑–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ)
> –£—Å—ñ –Ω–∞–∑–≤–∏ —Ç–∞–±–ª–∏—Ü—å –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é, –∑—Ä–æ–∑—É–º—ñ–ª—ñ –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤.

| –¢–∞–±–ª–∏—Ü—è | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–ª—è |
|----------|--------------|---------------|
| **documents** | –∑–±–µ—Ä—ñ–≥–∞—î —à–∞–ø–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–ø—Ä–∏—Ö—ñ–¥/—Ä–æ–∑—Ö—ñ–¥) | id, doc_type, doc_name, doc_number, doc_date, service_id, supplier_id, created_by, is_locked, created_at |
| **document_items** | –ø–æ–∑–∏—Ü—ñ—ó –≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ (—Ç–æ–≤–∞—Ä–∏) | id, document_id, item_name, item_code, unit, quantity, category, note |
| **stock_balance** | –∑–∞–ª–∏—à–∫–∏ –ø–æ —Å–ª—É–∂–±–∞—Ö —ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö | id, item_name, service_id, category, quantity, last_update |
| **services** | –ø–µ—Ä–µ–ª—ñ–∫ —Å–ª—É–∂–± (—ñ–Ω–∂–µ–Ω–µ—Ä–Ω–∞, –∑–≤‚Äô—è–∑–∫—É, –†–•–ë–ó —Ç–æ—â–æ) | id, name, code |
| **suppliers** | –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∏ –∞–±–æ –æ—Ç—Ä–∏–º—É–≤–∞—á—ñ | id, name, type |
| **users** | –æ–±–ª—ñ–∫–æ–≤—ñ –∑–∞–ø–∏—Å–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ | id, username, password_hash, role, created_at |
| **audit_log** | —ñ—Å—Ç–æ—Ä—ñ—è –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ | id, user_id, action, target_table, record_id, timestamp, note |

---

## üîó 4. Data Flow (–ø–æ—Ç—ñ–∫ –¥–∞–Ω–∏—Ö)
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —Å—Ç–≤–æ—Ä—é—î –¥–æ–∫—É–º–µ–Ω—Ç —É –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ.
2. Backend –ø–µ—Ä–µ–≤—ñ—Ä—è—î –¥–∞–Ω—ñ, –≤–∞–ª—ñ–¥—É—î –ø–æ–ª—è.
3. –î–∞–Ω—ñ –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –≤ —Ç–∞–±–ª–∏—Ü—ñ `documents` —ñ `document_items`.
4. –ú–æ–¥—É–ª—å –ª–æ–≥—ñ–∫–∏ –æ–Ω–æ–≤–ª—é—î `stock_balance`:
   - –Ø–∫—â–æ `type = –ø—Ä–∏—Ö—ñ–¥` ‚Üí –¥–æ–¥–∞—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å.
   - –Ø–∫—â–æ `type = —Ä–æ–∑—Ö—ñ–¥` ‚Üí –≤—ñ–¥–Ω—ñ–º–∞—î.
   - –Ø–∫—â–æ `quantity < 0` ‚Üí –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è *"–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ–≤–∞—Ä—É –Ω–∞ —Å–∫–ª–∞–¥—ñ"*.
5. –î–∞–Ω—ñ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å —É –∑–≤—ñ—Ç–∏ —á–µ—Ä–µ–∑ –∑–∞–ø–∏—Ç–∏ SELECT –∑ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏.
6. Backup-–º–æ–¥—É–ª—å —Ä–æ–±–∏—Ç—å –∫–æ–ø—ñ—é `main.db` —â–æ—Ç–∏–∂–Ω—è.

---

## üßÆ 5. Data Rules (–ø—Ä–∞–≤–∏–ª–∞ –¥–∞–Ω–∏—Ö)
- –£—Å—ñ –ø–æ–ª—è –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤—ñ, –∫—Ä—ñ–º `note`.
- `id` ‚Äî UUID –∞–±–æ autoincrement.
- `service_id`, `supplier_id` ‚Äî –∑–≤‚Äô—è–∑–∫–∏ —á–µ—Ä–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ –∫–ª—é—á—ñ (–ø—ñ—Å–ª—è —É–∑–≥–æ–¥–∂–µ–Ω–Ω—è `Relations_Map`).
- –ö–∞—Ç–µ–≥–æ—Ä—ñ—è (`category`) ‚Äî –≤—ñ–¥ 1 –¥–æ 5.
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å (`quantity`) ‚Äî —á–∏—Å–ª–æ–≤–µ –ø–æ–ª–µ –∑ 2 –∑–Ω–∞–∫–∞–º–∏ –ø—ñ—Å–ª—è –∫–æ–º–∏.

---

## üîê 6. Access Control (–∫–µ—Ä—É–≤–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø–æ–º)
| –†–æ–ª—å | –î–æ—Å—Ç—É–ø |
|------|--------|
| **Admin** | –ü–æ–≤–Ω–∏–π (—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è, –≤–∏–¥–∞–ª–µ–Ω–Ω—è, –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤, –¥–æ–≤—ñ–¥–Ω–∏–∫–∏, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ, –±–µ–∫–∞–ø) |
| **User** | –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤, –ø–µ—Ä–µ–≥–ª—è–¥ –∑–≤—ñ—Ç—ñ–≤, –±–µ–∑ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∞–±–æ –∑–º—ñ–Ω–∏ –¥–æ–≤—ñ–¥–Ω–∏–∫—ñ–≤ |

---

## üîÑ 7. Backup & Sync
- **Backup:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —â–æ—Ç–∏–∂–Ω—è + —Ä—É—á–Ω–∞ –∫–Ω–æ–ø–∫–∞.
- **Sync:** –Ω–∞—Ä–∞–∑—ñ –≤—ñ–¥—Å—É—Ç–Ω—è; –ø—ñ–∑–Ω—ñ—à–µ ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Flask API –∞–±–æ Git-–ø–∞—Ç—á—ñ.

---

## ‚öôÔ∏è 8. Config File (config.ini)
```
[system]
db_path = ./data/main.db
backup_path = ./backup/
backup_period_days = 7
unit_name = –í–ß –ê2600
year_start = 2024
admin_user = admin
admin_password = *****
```

---

## üìä 9. Architecture Summary
- **–¢–∏–ø:** Desktop/Web hybrid (–ª–æ–∫–∞–ª—å–Ω–∏–π —Å–µ—Ä–≤–µ—Ä + –±—Ä–∞—É–∑–µ—Ä)
- **–ë–∞–∑–∞:** SQLite (—î–¥–∏–Ω–∞ –∫–æ–ø—ñ—è, –æ—Ñ–ª–∞–π–Ω)
- **–ü—Ä–∏–Ω—Ü–∏–ø:** –ü—Ä–æ—Å—Ç–∞, —Å—Ç–∞–±—ñ–ª—å–Ω–∞, –±–µ–∑ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –º–µ—Ä–µ–∂—ñ
- **–†–æ–∑—à–∏—Ä–µ–Ω–Ω—è:** –º–æ–∂–ª–∏–≤–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è OCR, —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —Ç–∞ web-–ø–∞–Ω–µ–ª—ñ –≤ –º–∞–π–±—É—Ç–Ω—ñ—Ö —Å–ø—Ä–∏–Ω—Ç–∞—Ö.

---

## üí¨ 10. –ö–æ–º–µ–Ω—Ç–∞—Ä
> –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ = –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å —É –ø–æ–ª—å–æ–≤–∏—Ö —É–º–æ–≤–∞—Ö.  
> VTM —Å—Ç–≤–æ—Ä–µ–Ω–æ –Ω–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π ‚Äî –∞ –¥–ª—è —â–æ–¥–µ–Ω–Ω–æ—ó —Ä–µ–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏.

